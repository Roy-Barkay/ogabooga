!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var e=function(){return(e=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function t(e,t,r,n){return new(r||(r=Promise))((function(i,o){function s(e){try{c(n.next(e))}catch(e){o(e)}}function a(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))}function r(e,t){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function n(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),i=0;for(t=0;t<r;t++)for(var o=arguments[t],s=0,a=o.length;s<a;s++,i++)n[i]=o[s];return n}var i="WebSDK v1.1+273* 2023-03-29 16:19:24 +0200 5883fc0",o=(console.log.bind(console),console.error.bind(console),function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n]}),s=function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n]};function a(e,t,r,n){return new Promise((function(i,o){var a=new XMLHttpRequest;a.open(e?"POST":"GET",t),r&&r.forEach((function(e,t){a.setRequestHeader(t,e)})),a.addEventListener("load",(function(){i(a)})),a.addEventListener("error",(function(e){s("Reporter:xhr:onerror","Error occurred while loading "+t,a.status,a.statusText),o(e)})),a.send(n)}))}var c,u,l,h,p=function(e){var t=0;if(0===e.length)return t;for(var r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t&=t;return Math.abs(t)};!function(e){e[e.HTTP=0]="HTTP",e[e.INTENT=1]="INTENT",e[e.IFRAME=2]="IFRAME",e[e.TCP=3]="TCP",e[e.UDP=4]="UDP",e[e.STORAGE=5]="STORAGE",e[e.BLUETOOTH=6]="BLUETOOTH",e[e.EXTENSIONS=7]="EXTENSIONS",e[e.IPC=8]="IPC"}(c||(c={})),function(e){e[e.Mapping=0]="Mapping",e[e.SoftLaunch=1]="SoftLaunch",e[e.Enforce=2]="Enforce",e[e.KillSwitch=3]="KillSwitch"}(u||(u={})),function(e){e[e.blocked=1]="blocked",e[e.unknownDomain=2]="unknownDomain",e[e.unknownEndpoint=3]="unknownEndpoint",e[e.unknownParam=4]="unknownParam",e[e.dataViolation=5]="dataViolation",e[e.allowed=6]="allowed",e[e.anon=7]="anon",e[e.psuado=8]="psuado",e[e.structureViolation=9]="structureViolation"}(l||(l={})),function(e){e[e.NoIntervention=1]="NoIntervention",e[e.BlockEntirely=2]="BlockEntirely",e[e.ModifyRequest=3]="ModifyRequest"}(h||(h={}));var d=String(Math.round(1e9*Math.random())),f=function(){function e(t,r,n,s,c){var u=this;this.policyUrl=n,this.cb=c,this.segment=s,this.policyI=t,r?e.mode=this.policy.m:(a(!1,""+this.policyUrl+p(s)+".json?&sdkv="+i.split(" ")[1]+"&sdkm="+e.mode+"&sdkid="+d+"&group="+s,this.lastPolicyUpdate?new Map([["If-Modified-Since",this.lastPolicyUpdate]]):void 0).then((function(t){if(200==t.status)try{u.policyI=JSON.parse(t.responseText),u.lastPolicyUpdate=t.getResponseHeader("last-modified"),u.policy&&Object.keys(u.policy).length>0&&(console.log("policy downloaded + 200 status + valid"),e.mode=u.policy.m,o("WebWorkerController:start:setInterval","Policy has updated"),u.cb(u.policy))}catch(e){}})),this.listenToPolicyChange())}return Object.defineProperty(e.prototype,"policy",{get:function(){return this.policyI},enumerable:!0,configurable:!0}),e.prototype.updatePolicyUrl=function(e){this.policyUrl=e,this.t&&clearTimeout(this.t),this.listenToPolicyChange()},e.prototype.listenToPolicyChange=function(){var t=this;this.t=setTimeout((function(){a(!1,""+t.policyUrl+p(t.segment)+".json?&sdkv="+i.split(" ")[1]+"&sdkm="+e.mode+"&sdkid="+d+"&group="+t.segment,t.lastPolicyUpdate?new Map([["If-Modified-Since",t.lastPolicyUpdate]]):void 0).then((function(r){if(200==r.status)try{t.policyI=JSON.parse(r.responseText),t.lastPolicyUpdate=r.getResponseHeader("last-modified"),t.policy&&Object.keys(t.policy).length>0&&(e.mode=t.policy.m,o("WebWorkerController:start:setInterval","Policy has updated"),t.cb(t.policy))}catch(e){}})).finally((function(){t.listenToPolicyChange()}))}),3e5)},e.mode=u.KillSwitch,e}();function y(e){return String.fromCharCode.apply(null,Array.from(new Uint8Array(e)))}function g(e){for(var t=new ArrayBuffer(e.length),r=new Uint8Array(t),n=0,i=e.length;n<i;n++)r[n]=e.charCodeAt(n);return t}function v(e){return new Uint8Array(g(unescape(encodeURIComponent(e))))}function m(e){return btoa(y(e))}function b(e){return new Uint8Array(g(atob(e)))}var w=[0,0,0,0,0];function k(e,t){var r=t.length,n=e.length,i=n,o=new Uint8Array(n);o[0]=(i+0+e[0]+t[(0+i)%r])%256;for(var s=1;s<n;s++)o[s]=(e[s]+i+(o[s-1]^t[(s+i)%r])*(o[s-1]^t[(s+i)%r]))%256;return o}function E(e,t){for(var r=t.length,n=e.length,i=n,o=new Uint8Array(n),s=n-1;s>0;s--)o[s]=(e[s]-i-(e[s-1]^t[(s+i)%r])*(e[s-1]^t[(s+i)%r])+256+65536)%256;return o[0]=(e[0]-i-0-t[(0+i)%r]+768)%256,o}var A=[function(e,t){return k(e,t)},function(e,t){return k(e.reverse(),t)},function(e,t){return k(e,t)},function(e,t){return k(e.reverse(),t)}],x=[function(e,t){return E(e,t).reverse()},function(e,t){return E(e,t)},function(e,t){return E(e,t).reverse()},function(e,t){return E(e,t)}];function U(e,n,i){return t(this,void 0,void 0,(function(){var t,o,s;return r(this,(function(r){for(t=e?A:x,o=n,s=0;s<t.length;s++)o=t[s](o,i);return[2,o]}))}))}var T=[[["+",/\+/g],["-",/-/g]],[["/",/\//g],["_",/_/g]],[["=",/=/g],[".",/\./g]]];function I(e){var t=e||"";return T.forEach((function(e){t=t.replace(e[0][1],e[1][0])})),t}function P(e){var t=e||"";return T.forEach((function(e){t=t.replace(e[1][1],e[0][0])})),t}var S="31",C="43";var R=function(e){try{for(var t="string"==typeof e?v(e):e,r=0,n=0,i=0,o=0,s=new Uint8Array(8*(c=t,u=Math.floor(c.length/5),c.length%5==0?u:u+1));r<t.length;){var a=t[r];i>3?(o=(o=a&255>>i)<<(i=(i+5)%8)|(r+1<t.length?t[r+1]:0)>>8-i,r++):(o=a>>8-(i+5)&31,0===(i=(i+5)%8)&&r++),s[n]="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567".charCodeAt(o),n++}for(r=n;r<s.length;r++)s[r]=61;return s}catch(e){return console.error(e),new Uint8Array([])}var c,u},O=function(e){return I((t=R(e),decodeURIComponent(escape(y(t)))||"").toLowerCase());var t};function N(e,t,r){return t&&(t=O(b(P(t)))),r&&(r=O(b(P(r)))),function(e,t,r){var n="",i="";return t&&(n="$k"+e+"$"+t+"$"),r&&(i="$p"+e+"$"+r+"$"),n+i}(e,t,r)}function L(e){var t=new Uint8Array(e);return globalThis.crypto.getRandomValues(t),t}function M(){return t(this,void 0,Promise,(function(){return r(this,(function(e){switch(e.label){case 0:return[4,globalThis.crypto.subtle.generateKey({name:"AES-GCM",length:128},!0,["encrypt"])];case 1:return[2,e.sent()]}}))}))}function V(e){return t(this,void 0,Promise,(function(){var t;return r(this,(function(r){switch(r.label){case 0:return[4,globalThis.crypto.subtle.exportKey("raw",e)];case 1:return t=r.sent(),[2,m(new Uint8Array(t))]}}))}))}function _(e,n){return t(this,void 0,Promise,(function(){var t,i;return r(this,(function(r){switch(r.label){case 0:return t=L(12),[4,globalThis.crypto.subtle.encrypt({name:"AES-GCM",iv:t,tagLength:128},e,v(n))];case 1:return i=r.sent(),[2,I(m(new Uint8Array(w.concat(Array.from(t).concat(Array.from(new Uint8Array(i)))))))]}}))}))}var D=function(e){return e.replace(/-/g,"+").replace(/_/g,"/")};function K(e,n,i){return t(this,void 0,Promise,(function(){var t,o;return r(this,(function(r){switch(r.label){case 0:return[4,globalThis.crypto.subtle.importKey("raw",e,{name:"HMAC",hash:{name:"SHA-256"},length:8*e.byteLength},!1,["sign"])];case 1:return t=r.sent(),[4,globalThis.crypto.subtle.sign({name:"HMAC",hash:{name:"SHA-256"}},t,n)];case 2:return o=r.sent(),[2,o.slice(0,i||32)]}}))}))}function F(e,n){return t(this,void 0,void 0,(function(){var t,i;return r(this,(function(r){switch(r.label){case 0:return t=new Uint8Array(new Array(32).fill(0)),i=new Uint8Array([1]),[4,K(t,e,32)];case 1:return[4,K(r.sent(),i,n)];case 2:return[2,r.sent()]}}))}))}function B(e,n){return t(this,void 0,Promise,(function(){var t,i,o,s,a,c,u,l,h,p;return r(this,(function(r){switch(r.label){case 0:return t=null,[4,globalThis.crypto.subtle.generateKey({name:"ECDH",namedCurve:"P-256"},!0,["deriveBits"])];case 1:return(i=r.sent()).publicKey&&i.privateKey?[4,globalThis.crypto.subtle.deriveBits({name:"ECDH",namedCurve:"P-256",public:e},i.privateKey,256)]:[3,9];case 2:return o=r.sent(),[4,globalThis.crypto.subtle.exportKey("jwk",i.publicKey)];case 3:return(s=r.sent()).x&&s.y?(a=function(e,t){void 0===t&&(t=32);var r=e.x,n=e.y,i=new Uint8Array(1+2*t);return i[0]=4,i.set(b(D(r)),1),i.set(b(D(n)),1+t),i}({x:s.x,y:s.y}),[4,F(new Uint8Array(Array.from(a).concat(Array.from(new Uint8Array(o)))),16)]):[3,7];case 4:return c=r.sent(),u=L(12),[4,globalThis.crypto.subtle.importKey("raw",c,{name:"AES-GCM",length:128},!0,["encrypt"])];case 5:return l=r.sent(),[4,globalThis.crypto.subtle.encrypt({name:"AES-GCM",iv:u,tagLength:128},l,n)];case 6:return h=r.sent(),p=w.concat(Array.from(a)).concat(Array.from(u)).concat(Array.from(new Uint8Array(h))),[2,m(new Uint8Array(p))];case 7:t="Can't load JWK x,y",r.label=8;case 8:return[3,10];case 9:t="Couldn't create ECDH-E",r.label=10;case 10:return[2,t]}}))}))}function q(e){return t(this,void 0,Promise,(function(){var t,n,i,o;return r(this,(function(r){switch(r.label){case 0:return[4,globalThis.crypto.subtle.importKey("jwk",JSON.parse(e),{name:"ECDH",namedCurve:"P-256"},!0,[])];case 1:return t=r.sent(),[4,M()];case 2:return[4,V(n=r.sent())];case 3:return i=r.sent(),o=b(i),[4,B(t,o)];case 4:return[2,{AsymEncUserKeyB64:I(r.sent()),UserGCM:n,UserGCMKey:i}]}}))}))}var W=self;function J(e,n){return t(this,void 0,void 0,(function(){var t,i,o,s,a;return r(this,(function(r){switch(r.label){case 0:return W.__hkdf_pass_cache[n]?[3,2]:(t=W.__hkdf_pass_cache,i=n,o=Uint8Array.bind,[4,F(v(n),32)]);case 1:t[i]=new(o.apply(Uint8Array,[void 0,r.sent()])),r.label=2;case 2:return s=W.__hkdf_pass_cache[n],[4,U(!0,v(e),s)];case 3:return a=r.sent(),[2,I(m(a))]}}))}))}W.__hkdf_pass_cache={};var H,j=(H={}," ,.-/$%:?\"='\\\r\t\n".split("").map((function(e){return[e,!0]})).forEach((function(e){return H[e[0]]=e[1]})),H);function Q(e,t,r){for(var i=n(e||""),o=[],s=0;s<i.length;s++)s%(t+r)>=t||j[i[s]]?o.push(i[s]):o.push("#");return o.join("")}var $="286f0525-9a21-47d0-bd20-de95ab8429ac",G="be67051c-10a4-95e9-d149-e26eff0c7860-fafe8559-d2ff-4272-9bb0-7b76b87f6fc1";function X(e){return e>="a"?e.charCodeAt(0)-"a".charCodeAt(0)+10:e>"A"?e.charCodeAt(0)-"A".charCodeAt(0)+10:e.charCodeAt(0)-"0".charCodeAt(0)}function Y(e,t){for(var r="",n=0;n<e.length;n++)"-"!=e[n]&&(r+=e[n]);var i="";for(n=0;n<t.length;n++)"-"!=t[n]&&(i+=t[n]);return function(e){for(var t="",r=0;r<e.length;r+=2)t+=String.fromCharCode(parseInt(e.substring(r,r+2),16));return btoa(t)}(function(e,t){var r=e.length,n=t.length;if(0==r||0==n)return"0";for(var i=[],o=0;o<r+n;o++)i.push(0);for(var s=0,a=0,c=r-1;c>=0;c--){var u=0,l=X(e[c]);a=0;for(var h=n-1;h>=0;h--){var p=l*X(t[h])+i[s+a]+u;u=Math.trunc(p/16),i[s+a]=p%16,a++}u>0&&(i[s+a]+=u),s++}for(var d=i.length-1;d>=0&&0==i[d];)d--;if(-1==d)return"0";for(var f,y="";d>=0;)y+=(f=i[d--])<10?String.fromCharCode("0".charCodeAt(0)+f):String.fromCharCode("a".charCodeAt(0)+(f-10));return y}(r,i))}var z,Z=function(e,t,r){void 0===t&&(t="be67051c-10a4-95e9-d149-e26eff0c7860"),void 0===r&&(r=new TextEncoder);for(var n=r.encode(e),i=r.encode(t),o=new Uint8Array(n.length),s=0,a=0;a<n.length;a++)o[a]=n[a]^i[s],++s===i.length&&(s=0);for(var c="",u=0,l=o;u<l.length;u++){var h=l[u];c+=String.fromCharCode(h)}return"$p2$"+btoa(c)},ee=function(){var e=this;this.encKey=Y($,G),this.encAlgo="symmetric.v1",this.setCustomEncryptLegacy=function(t){e.customEncrypt=t},this.setEncKey=function(t){e.encKey=Y(t,$)},this.setEncAlgoType=function(t){e.encAlgo=t.toLowerCase()},this.encryptV1=function(t){return"function"==typeof e.customEncrypt?e.customEncrypt(t):Z(t,e.encKey)},this.encryptValue=function(n){return t(e,void 0,void 0,(function(){var e,t;return r(this,(function(r){switch(r.label){case 0:e="<report-enc-error>",r.label=1;case 1:switch(r.trys.push([1,7,,8]),this.encAlgo){case"symmetric.v2":return[3,2];case"none":return[3,4];case"symmetric.v1":return[3,5]}return[3,6];case 2:return[4,J(n,this.encKey)];case 3:return e=r.sent(),e=N(S,"",e),[3,6];case 4:return e=n,[3,6];case 5:return e=this.encryptV1(n),[3,6];case 6:return[3,8];case 7:return t=r.sent(),console.error("qp-enc-error",t),[3,8];case 8:return[2,e]}}))}))},this.sanitizeParam=function(n){return t(e,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return[4,this.encryptValue(n)];case 1:return[2,e.sent()]}}))}))}},te=new function(){var e=this;this.encKey=Y($,G),this.encAlgo="symmetric.v1",this.maskAlgo="none",this.setCustomMaskLegacy=function(t){e.customMask=t},this.setCustomEncryptLegacy=function(t){e.customEncrypt=t},this.setEncKey=function(t){e.encKey=Y(t,$)},this.setEncAlgoType=function(t){e.encAlgo=t.toLowerCase()},this.setMaskAlgoType=function(t){e.maskAlgo=t.toLowerCase()},this.maskV1=function(t){return e.customMask?e.customMask(t):t.split(" ").map((function(e){return e.split("-").map((function(e){return e.split(",").map((function(e){return e.split("_").map((function(e){var t=Math.floor((e.length+1)/2);return"#".repeat(t)+e.substring(t)})).join("_")})).join(",")})).join("-")})).join(" ")},this.encryptV1=function(t){return"function"==typeof e.customEncrypt?e.customEncrypt(t):Z(t,e.encKey)},this.createAssymetricV2Key=function(){return t(e,void 0,void 0,(function(){var e;return r(this,(function(t){switch(t.label){case 0:return[4,q(this.encKey)];case 1:return(e=t.sent())?(this._asymmetric_v2_crypto_key=e.UserGCM,[2,N(C,e.AsymEncUserKeyB64,"")]):(console.error("Can't use qp asymmetric key!"),[2,"<qp-asym2-error>"])}}))}))},this.maskParam=function(n){return t(e,void 0,void 0,(function(){var e;return r(this,(function(t){e="<report-mask-error>";try{switch(this.maskAlgo){case"every4":e=Q(n,4,4);break;case"every8":e=Q(n,8,8);break;case"mask4skip8":e=Q(n,4,8);break;case"mask8skip4":e=Q(n,8,4);break;case"none":e=this.maskV1(n);break;default:e=n}}catch(e){console.error("qp-mask-error",e)}return[2,e]}))}))},this.encryptValue=function(n){return t(e,void 0,void 0,(function(){var e,t;return r(this,(function(r){switch(r.label){case 0:e="<report-enc-error>",r.label=1;case 1:switch(r.trys.push([1,11,,12]),this.encAlgo){case"symmetric.v2":return[3,2];case"asymmetric.v2":return[3,4];case"none":return[3,8];case"symmetric.v1":return[3,9]}return[3,10];case 2:return[4,J(n,this.encKey)];case 3:return e=r.sent(),e=N(S,"",e),[3,10];case 4:return this._asymmetric_v2_crypto_key?[3,5]:(e="<asym-key-not-ready>",[3,7]);case 5:return[4,_(this._asymmetric_v2_crypto_key,n)];case 6:e=r.sent(),e=N(C,"",e),r.label=7;case 7:return[3,10];case 8:return e=n,[3,10];case 9:return e=this.encryptV1(n),[3,10];case 10:return[3,12];case 11:return t=r.sent(),console.error("qp-enc-error",t),[3,12];case 12:return[2,e]}}))}))},this.sanitizeParam=function(n){return t(e,void 0,void 0,(function(){var e;return r(this,(function(t){switch(t.label){case 0:return e=this.encryptValue,[4,this.maskParam(n)];case 1:return[4,e.apply(this,[t.sent()])];case 2:return[2,t.sent()]}}))}))}},re=new ee;!function(e){e[e.xhr=100]="xhr",e[e.cookie=101]="cookie",e[e.postMessage=102]="postMessage",e[e.websocket=103]="websocket",e[e.sendbeacon=104]="sendbeacon",e[e.fetch=105]="fetch",e[e.location=106]="location",e[e.link=107]="link",e[e.form=108]="form",e[e.src=109]="src",e[e.href=110]="href",e[e.data=111]="data",e[e.srcset=112]="srcset",e[e.lowsrc=113]="lowsrc",e[e.worker=114]="worker",e[e.AndroidUrl=201]="AndroidUrl",e[e.AndroidIntent=202]="AndroidIntent",e[e.iOSUrl=301]="iOSUrl"}(z||(z={}));var ne,ie,oe=function(e,t){if(this.protocol=e,"string"==typeof t){var r=new URL(t,location.origin);this.hostname=r.hostname,this.pathname=r.pathname.split("?")[0].split(";")[0]}else this.hostname=t.host,this.pathname=t.endpoint};function se(i){return t(this,void 0,Promise,(function(){var o,s,a=this;return r(this,(function(c){switch(c.label){case 0:return[4,Promise.all(i.map((function(e){return new Promise((function(n,i){return t(a,void 0,void 0,(function(){var t;return r(this,(function(r){switch(r.label){case 0:return t=e,[4,e.data];case 1:return t.data=r.sent(),n(),[2]}}))}))}))})))];case 1:return c.sent(),o=new Map,i.forEach((function(e){if(e){var t=JSON.stringify(e.meta),r=o.get(t);r||(r=new Array,o.set(t,r)),r.push(e)}})),s=new Array,o.forEach((function(t,r){s.push(e(e({},JSON.parse(r)),t.reduce((function(e,t){for(var r=t.data,i=0,o=Object.keys(r).map((function(e){return parseInt(e)}));i<o.length;i++){var s=o[i],a=e[s];e[s]=a?n(a,r[s]):r[s]}return e}),{})))})),[2,s]}}))}))}function ae(e){return t(this,void 0,Promise,(function(){var t,n;return r(this,(function(r){switch(r.label){case 0:return e?[4,Promise.all(e.map((function(e){return e.value})))]:[2,""];case 1:for(t=r.sent(),n=0;n<t.length;n++)e[n].value=t[n];return[2,JSON.stringify(e.reduce((function(e,t){return e[t.param]=t.value,e}),{}))]}}))}))}!function(e){e[e.Web=0]="Web",e[e.Android=1]="Android",e[e.iOS=3]="iOS"}(ne||(ne={})),function(e){e[e.UnknownDomain=41]="UnknownDomain",e[e.UnknownEndpoint=42]="UnknownEndpoint",e[e.UnknownParam=43]="UnknownParam",e[e.DataViolationEndpoint=52]="DataViolationEndpoint",e[e.DataViolationParam=53]="DataViolationParam",e[e.Allowed=6]="Allowed",e[e.Anon=61]="Anon",e[e.Psuedo=62]="Psuedo",e[e.Blocked=7]="Blocked",e[e.StructureViolation=83]="StructureViolation",e[e.Mapping=9]="Mapping"}(ie||(ie={}));var ce,ue,le=function(){function i(i,o,s,a,c){var u=this;this.meta=i;var h=s[0],p=String(null!=h.domainIndex?h.domainIndex:o.hostname),d=String(null!=h.endpointIndex?h.endpointIndex:o.pathname),f=h.channel+"",y=e({q:Date.now(),t:o.protocol,u:[f,p,d]},this.toFinders(o,h));function g(e){var t=new Array;if(s.forEach((function(r){if(!(Array.isArray(e)&&!e.includes(r.code)||!Array.isArray(e)&&r.code!=e)){var n=r.origValue;n&&(n.value&&(n.value=te.sanitizeParam(n.value)),r.code!=l.dataViolation&&n.regexIndex&&t.push({param:"qpregex__"+n.param,value:""+n.regexIndex}),t.push(n))}})),e==l.allowed&&c)try{var r=new URL(c);"cookie"==p?t.forEach((function(e){t.push({param:"$_pp_"+e.param,value:"HTTP::"+r.hostname+"::"+r.pathname})})):t.push({param:"$ep_parent",value:"HTTP::"+r.hostname+"::"+r.pathname})}catch(e){}return t}var v=void 0;this.data=t(u,void 0,void 0,a?function(){var t,i,s,c,u,h,p,d,m,b,w,k,E,A,x;return r(this,(function(r){switch(r.label){case 0:switch(a){case ie.UnknownDomain:case ie.UnknownEndpoint:return[3,1];case ie.Mapping:return[3,3];case ie.Blocked:return[3,5]}return[3,7];case 1:return E={},t=a+"",i=[e({},y)],s={},c=[y.u],[4,ae(g([l.unknownEndpoint,l.unknownDomain]))];case 2:return E[t]=[e.apply(void 0,i.concat([(s.u=n.apply(void 0,c.concat([[r.sent()]])),s)]))],v=E,[3,7];case 3:return A={},u=a+"",h=[e({},y)],p={},d=[f,o.hostname,o.pathname],[4,ae(g(l.allowed))];case 4:return A[u]=[e.apply(void 0,h.concat([(p.u=d.concat([r.sent()]),p)]))],v=A,[3,7];case 5:return x={},m=a+"",b=[e({},y)],w={},k=[y.u],[4,ae(g(l.blocked))];case 6:return x[m]=[e.apply(void 0,b.concat([(w.u=n.apply(void 0,k.concat([[r.sent()]])),w)]))],v=x,[3,7];case 7:return[2,v]}}))}:function(){var i,o,s=this;return r(this,(function(a){switch(a.label){case 0:return[4,(i=function(i,o){return t(s,void 0,void 0,(function(){var t,s,a,c,u,h,p,d,f,m,b,w;return r(this,(function(r){switch(r.label){case 0:if(!(t=g(o)).length)return[2];if(o!=l.structureViolation&&o!=l.dataViolation)return[3,5];s=0,a=t,r.label=1;case 1:return s<a.length?(c=a[s],v||(v={}),v[i]||(v[i+""]=new Array),h=(u=v[i+""]).push,p=[e({},y)],d={},f=[y.u],[4,ae([c])]):[3,4];case 2:h.apply(u,[e.apply(void 0,p.concat([(d.u=n.apply(void 0,f.concat([[r.sent()]])),d.s=c.value,d.r=c.regexIndex,d)]))]),r.label=3;case 3:return s++,[3,1];case 4:return[2];case 5:return i!=ie.UnknownParam?[3,7]:[4,ae(t)];case 6:return b=r.sent(),[3,8];case 7:b=JSON.stringify(t.map((function(e){return e.paramIndex}))),r.label=8;case 8:return m=b,w=e(e({},y),{u:n(y.u,[m])}),v||(v={}),v[i]||(v[i+""]=new Array),v[i+""].push(w),[2]}}))}))})(ie.Blocked,l.blocked)];case 1:return a.sent(),[4,i(ie.Allowed,l.allowed)];case 2:return a.sent(),[4,i(ie.Anon,l.anon)];case 3:return a.sent(),[4,i(ie.Psuedo,l.psuado)];case 4:return a.sent(),[4,i(ie.UnknownParam,l.unknownParam)];case 5:return a.sent(),[4,i(ie.DataViolationParam,l.dataViolation)];case 6:return a.sent(),[4,i(ie.StructureViolation,l.structureViolation)];case 7:return a.sent(),v||((o={})[ie.Allowed+""]=[e(e({},y),{u:n(y.u,["[]"])})],v=o),[2,v]}}))})}return i.prototype.toFinders=function(e,t){return{fd:t.domainFinderUsed?{f:t.domainFinderUsed,o:e.hostname}:void 0,fe:t.endpointFinderUsed?{f:t.endpointFinderUsed,o:e.pathname}:void 0}},i}(),he=function(){function e(e,t,r){void 0===r&&(r=!1),this.serverUrl=e,this.ignoreLogs=t,this.ip=r,this.eventQueue=new Array,this.eventErrs=new Array,this.cacheDnsHosts=Array(),this.cacheDnsIPs=Array(),this.getLoggingTokens(),this.start()}return e.prototype.updateReportServer=function(e){this.serverUrl!=e&&(this.serverUrl=e,this.getLoggingTokens())},e.prototype.getIP=function(e){var t=this;return new Promise((function(r,n){var i=t.cacheDnsHosts.indexOf(e);if(-1!=i)return r(t.cacheDnsIPs[i]);fetch("https://dns.google.com/resolve?name="+e).then((function(e){return e.json()})).then((function(n){var i=n.Answer;if(i)for(var o=0;o<i.length;o++)if(1==i[o].type){var s=i[o].data;return t.cacheDnsHosts.push(e),t.cacheDnsIPs.push(s),r(s)}return t.cacheDnsHosts.push(e),t.cacheDnsIPs.push(""),r("")})).catch((function(n){return t.cacheDnsHosts.push(e),t.cacheDnsIPs.push(""),r("")}))}))},e.prototype.report2=function(e,t,r,n){var i=this,o=r[0].code,s=0;if(e.m==u.Mapping)s=ie.Mapping;else switch(o){case l.unknownDomain:s=ie.UnknownDomain;break;case l.unknownEndpoint:s=ie.UnknownEndpoint;break;case l.blocked:s=ie.Blocked}s&&this.ignoreLogs&&this.ignoreLogs.includes(ie.Mapping.toString())||(s==ie.Mapping&&this.ip?this.getIP(t.hostname).then((function(o){var a=o.split(".");o&&(t.hostname+="|"+a[0]+"."+a[1]+"."+a[2]+".xxx"),i.eventQueue.push(new le(e,t,r,s,n))})):this.eventQueue.push(new le(e,t,r,s,n)))},e.prototype.start=function(){this.interval=self.setInterval(this.sendEvents.bind(this),2e4)},e.prototype.sendEvents=function(){return t(this,void 0,void 0,(function(){function e(e){for(var t=e[0],r=function(r){var i=e[r];s.forEach((function(e){i[e]&&(t[e]||(t[e]=new Array),t[e]=n(t[e],i[e]))}))},i=1;i<e.length;i++)r(i);return t}var t,i,s,c,l,h=this;return r(this,(function(r){switch(r.label){case 0:return[4,se(this.eventQueue)];case 1:if(!(t=n.apply(void 0,[r.sent(),this.eventErrs])).length)return[2];for(this.eventQueue=new Array,this.eventErrs=new Array,i=new Array,s=[ie.Allowed,ie.Anon,ie.Blocked,ie.DataViolationEndpoint,ie.DataViolationEndpoint,ie.DataViolationParam,ie.Mapping,ie.Psuedo,ie.StructureViolation,ie.UnknownDomain,ie.UnknownEndpoint,ie.UnknownParam];c=t[0];)l=t.filter((function(e){return e.m==c.m&&e.v==c.v&&e.s==c.s})),t=t.filter((function(e){return e.m!=c.m||e.v!=c.v||e.s!=c.s})),i.push(e(l));return o("Reporter:sendEvents","Event",t),i.forEach((function(e){if(h.ignoreLogs)for(var t=0;t<h.ignoreLogs.length;t++)delete e[parseInt(h.ignoreLogs[t])];var r=!0;if(Object.keys(e).forEach((function(t){Array.isArray(e[t])&&(r=!1)})),!r&&e.m!=u.KillSwitch)a(!0,h.serverUrl+"/logs/write",new Map([["Content-Type","text/plain"],["x-log-token",h.token||""],["x-log-hash",h.hash||""]]),JSON.stringify(e)).then((function(t){o("Reporter:sendEvents:onload",t.status,t.statusText),200!==t.status&&h.handleError(e)})).catch((function(t){h.handleError(e)}))})),[2]}}))}))},e.prototype.handleError=function(e){this.eventErrs.push(e),this.getLoggingTokens()},e.prototype.getLoggingTokens=function(){var e=this;a(!1,this.serverUrl+"/auth/create").then((function(t){var r=t.getResponseHeader("x-log-token");r&&(e.token=r),(r=t.getResponseHeader("x-log-hash"))&&(e.hash=r),o("Reporter:getLoggingTokens:onload",t.status,e.token,e.hash)}))},e}();!function(e){e[e.register=1]="register",e[e.process2=2]="process2",e[e.control=3]="control",e[e.report=4]="report",e[e.defineFunction=5]="defineFunction",e[e.addTrustedDomains=6]="addTrustedDomains",e[e.setIgnoreList=7]="setIgnoreList",e[e.updateSegment=8]="updateSegment",e[e.liteBlockLog=9]="liteBlockLog",e[e.setUQ=10]="setUQ",e[e.setPassword=11]="setPassword",e[e.setMaskType=12]="setMaskType",e[e.setEncryptType=13]="setEncryptType",e[e.setEncryptTypeAndUQ=14]="setEncryptTypeAndUQ",e[e.setThirdPartyEncrypt=15]="setThirdPartyEncrypt"}(ce||(ce={})),function(e){e[e.init=1]="init",e[e.param=2]="param"}(ue||(ue={}));var pe,de,fe;!function(e){e[e.start=1]="start",e[e.end=2]="end",e[e.param=3]="param"}(pe||(pe={})),function(e){e[e.mask=1]="mask",e[e.encrypt=2]="encrypt"}(de||(de={})),function(e){e[e.start=1]="start",e[e.flush=2]="flush"}(fe||(fe={}));var ye=function(){function e(){this.done=!1,this.v=new Array,this.x=new Array}return e.prototype.resolve=function(e){if(this.done)throw"already resolved";this.res=e,this.done=!0,this.v.forEach((function(t){t(e)}))},e.prototype.reject=function(e){if(this.done)throw"already resolved";this.err=e,this.done=!0,this.x.forEach((function(t){t(e)}))},e.prototype.then=function(e){return this.done?this.res&&e(this.res):this.v.push(e),this},e.prototype.catch=function(e){return this.done?this.err&&e(this.err):this.x.push(e),this},e}(),ge=(function(){function e(t,r,n){this.channel=t,this.source=n,this.firePromise=new Array,this.url=new oe(n,r),this.id=Math.random(),3!=t||u.Mapping==f.mode?this.initPromise=e.init(this.id,this.channel,this.url.hostname,this.url.pathname,this.source,this.parseCaller()):this.initPromise=new ye}e.prototype.parseCaller=function(){if(u.Mapping==f.mode)try{var e=function(){var e=Error.stackTraceLimit;try{Error.stackTraceLimit=1e5;var t=(new Error).stack.split("\n"),r=void 0;return t&&(r=t[t.length-1]),""==r&&(r=t[t.length-2]),Error.stackTraceLimit=e,r}catch(t){Error.stackTraceLimit=e}}();if(!e)return;e.includes("(")&&e.includes(")")&&(e=e.substring(e.lastIndexOf("(")+1,e.indexOf(")"))),e.includes("at ")&&(e=e.substring(e.indexOf("at ")+3)),e.includes("@")&&(e=e.substring(e.indexOf("@")+1));var t=new URL(e,location.origin);return t.pathname.includes(":")&&(t.pathname=t.pathname.substring(0,t.pathname.indexOf(":"))),t.search.includes(":")&&(t.search=t.search.substring(0,t.search.indexOf(":"))),t.href}catch(e){}},e.prototype.fire=function(t,r){o("Trigger2:fire",this.source,this.url.hostname,this.url.pathname,r);var n=this.id,i=new Promise((function(i,o){if(r instanceof Blob){var s=new FileReader;s.onload=function(){e.fire(n,t,s.result).then(i).catch(o)},s.onerror=function(e){o(e)},s.readAsText(r,"utf-8")}else if(r instanceof ReadableStream){var a="",c=r.getReader();!function r(){c.read().then((function(s){if(a+=new TextDecoder("utf-8").decode(s.value),!s.done)return r();e.fire(n,t,a).then(i).catch(o)})).catch((function(e){o(e)}))}()}else e.fire(n,t,r).then(i).catch(o)}));return this.firePromise.push(i),i},e.prototype.end=function(){3==this.channel&&u.Mapping!=f.mode||e.end(this.id)},e.prototype.done=function(){var e=this;return new Promise((function(t,r){Promise.all(e.firePromise).then((function(e){return t()})).catch(r)}))}}(),[null,function(e,t){return String.prototype.startsWith.call(e,t)},function(e,t){return String.prototype.endsWith.call(e,t)},function(e,t){return-1!==String.prototype.indexOf.call(e,t)}]),ve=function(e,t,r){return function(n){if(4===t)return r;var i=ge[t];return i&&i(n,e)?r:null}},me={_r:/\b[023][0-9]{8}\b/g,_checkId:function(e){for(var t=0,r=0,n=0;n<9;n++)t+=(r=(e[n]-"0")*(n%2+1))>9?r-9:r;return t%10==0},set lastIndex(e){this._r.lastIndex=0},exec:function(e){var t=e.match(this._r);if(!t||!t.length||t[0].length>9)return null;for(var r=0;r<t.length;r++)if(this._checkId(t[r])){var n=Array(1);return n.input=e,n}return null}},be=function(){function e(e){this._r=e}return e.prototype._checkCreditCard=function(e){if(/[^0-9-\s]+/.test(e))return!1;for(var t=0,r=0,n=!1,i=(e=e.replace(/\D/g,"")).length-1;i>=0;i--){var o=e.charAt(i);r=parseInt(o,10);n&&(r*=2)>9&&(r-=9),t+=r,n=!n}return t%10==0},Object.defineProperty(e.prototype,"lastIndex",{set:function(e){this._r.lastIndex=0},enumerable:!0,configurable:!0}),e.prototype.exec=function(e){var t=e.match(this._r);if(!t||!t.length)return null;for(var r=0;r<t.length;r++)if(this._checkCreditCard(t[r])){var n=Array(1);return n.input=e,n}return null},e}(),we=/^\+?(972|0)(\-)?0?(([23489]{1}\d{7})|[5]{1}\d{8})\b/g,ke=/^0\d([\d]{0,1})([-]{0,1})\d{7}$/g,Ee=new be(/^4[0-9]{12}(?:[0-9]{3})?$/g),Ae=new be(/\b(?:5[1-5][0-9]{2}|222[1-9]|22[3-9][0-9]|2[3-6][0-9]{2}|27[01][0-9]|2720)[0-9]{12}\b/g),xe=new be(/\b0010(?:11|17|20|37|38|39|40|90|91|96|97|99)[0-9]{6}|3640946[0-7][0-9]{6}|364370[0-9]{8}|3655676[0-4][0-9]{6}|4580(?:06|09|16|26|29|52|79|80|86|96|99)[0-9]{10}|510046[05]2[0-9]{8}|5189(?:[89]602|(?:89|91)[0-9]{2})[0-9]{8}|53640(?:6[0156]2|7[0156]0)[0-9]{8}|5477(?:07[015]2|14[0-9]{2})[0-9]{8}|55218(?:302|400)[0-9]{8}\b/g),Ue=/hacker/i,Te=[];var Ie=/^[0-9]+$/,Pe=function(e){return function(t,r){if(r!=e.indexOf(Ue)||!Te.length)return r!=e.indexOf(we)||Se(we,t)?Se(e[r],t):Se(ke,t);for(var n=0;n<Te.length;n++)if(t.toLowerCase().includes(Te[n].toLowerCase()))return!0}};function Se(e,t){if(e){var r=null!=e.exec(t);return e.lastIndex=0,r}}var Ce,Re={checkPrivacyViolation:Pe([null,Ee,Ae,me,Ue,xe,/-----BEGIN CERTIFICATE-----((.|\n)*)-----END CERTIFICATE-----/g,/\b[A-Z]{4}[0-9]{2}\b/g,/^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/g,we,/(11|0011|0017|17)\\(0[0-9]{3})\\([0-9]{8}|[0-9]{5})(\s|$)/g]),checkStructureValidation:Pe([null,Ie,/^[a-zA-Z]+$/,/^.{1,25}$/]),setRegexWords:function(e){e.forEach((function(e){Te.push(e)}))}};function Oe(e,t,r){var n=null;if(t){for(var i=0;i<t.length;i++)for(var o=t[i].keys,s=0;s<o.length;s++)o[s]==e&&(n=t[i].group);if(null!=n)return r?r[n]:0!=n}return!1}!function(e){e[e.Continue=1]="Continue",e[e.Trusted=2]="Trusted",e[e.Block=3]="Block"}(Ce||(Ce={}));var Ne,Le,Me=function(){function e(e,t,r,i,o,s,a){var c=this;if(this.policy=e,this.lt=t,this.cm=r,this.regexForUnkown=o,a&&Re.setRegexWords(a),this.version=e.v,this.eventServerUrl=e.s,this.mode=e.m,this.trustedDomains=e.wl,this.regexForUnknown=o||[1,2,3,4,5,6,7,8,9,10],this.trustedParamExpression=s,this.domainRegexes=Array(),i&&i.forEach((function(e){var t=function(e,t,r){var i=e.split(/\{(?:.-.)(?:,(?:.,.))?\}/g);i=i.map((function(e){return e.replace(/([\\\^\$\{\}\[\]\(\)\.\*\+\?\|\<\>\-\&])/g,"\\$1").replace(/\\\*/g,".*").replace(/\\\?/g,".")}));var o=[];if(e.matchAll(/\{(.-.)(?:,(.,.))?\}/g)[0]&&(o=(o=n(e.matchAll(/\{(.-.)(?:,(.,.))?\}/g))).map((function(e){return e[2]?"["+e[1]+"]{"+e[2]+"}":"["+e[1]+"]"}))),0==i.length)return["",""];if(1==i.length)return[i[0],""];if(i.length-1!=o.length)throw new Error("Why splitter length is not N-1?");for(var s="",a=0;a<i.length-1;a++)s+=i[a]+o[a];return s+=i[i.length-1],r||(s="\\b"+s+"\\b"),[s,t?"i":""]}(e[0],!0,!1);c.domainRegexes.push({domain:e[1],regex:new RegExp(t[0],t[1])})})),this.trustedParamExpression)for(var u=0;u<this.trustedParamExpression.length;u++){var l=this.trustedParamExpression[u];if(!this.policy.d)return;var h=this.policy.d[+l[0]];if(!h||!h.d)return;var p=h.d[l[1]];if(!p||!p.d)return;var d=p.d[l[2]];if(!d||!d.d)return;var f=d.d[l[3]];f&&(f.trustedForRegex?f.trustedForRegex.push(l[4]):f.trustedForRegex=[l[4]])}}return e.prototype.liteRegexViolation=function(e){if(this.lt&&this.lt.regexList)for(var t=this.lt.regexList,r=0;r<t.length;r++){if(RegExp(t[r][0],t[r][1]).test(e))return r}},e.prototype.isTrustedDomain=function(e,t){if(void 0===t&&(t=Array()),!e)return!0;var r=this.trustedDomains.concat(t);return r.indexOf(e)>-1||-1!==r.findIndex((function(t){return e.endsWith("."+t)}))},e.prototype.checkDataViolation2=function(e,t){if(t)for(var r=0;r<t.length;r++)if(Re.checkPrivacyViolation(e,t[r]))return{regexIndex:t[r]}},e.prototype.checkStructureViolation2=function(e,t){if(t)for(var r=0;r<t.length;r++)if(Re.checkStructureValidation(e,t[r]))return{regexIndex:t[r]}},e.prototype.getParamRule2=function(e,t){if(!t||!t.d)return null;var r=t.d[e];return r?(Object.keys(t.d).forEach((function(t){var n;if(t.includes("$ignore")){var i=t.split("/"),o=i[1];if(e==o){var s=i[0].split("-");if(s.length>1){(null==r?void 0:r.trustedForRegex)||(r.trustedForRegex=[]);for(var a=1;a<s.length;a++)parseInt(s[a])&&-1==r.trustedForRegex.indexOf(s[a])&&(null===(n=null==r?void 0:r.trustedForRegex)||void 0===n||n.push(s[a]))}else r.trustedForRegex=["1","2","3","4","5","6","7","8","9","10"]}}})),r):void 0},e.prototype.getEndpointRule2=function(e,t){if(!t||!t.d)return{rule:null};var r=String(p(e));if(t.d[r])return{rule:t.d[r],hash:r};if(!t.f||!t.f.length)return{rule:null};for(var n,i,o=t.f.map((function(e){var t=e[0],r=e[1],n=e[2];return ve(t,r,n)})),s=0;s<o.length;s++)if(n=o[s](e)){i=s;break}return n?{rule:t.d[n],hash:n,usedFinder:i}:{rule:null}},e.prototype.checkIfAllowAllParams=function(e,t){return!!e&&(e.d&&e.d.$all?e.d.$all:null)},e.prototype.getDomainRule2=function(e,t){if(!t||!t.d)return{};var r=String(p(e)),n=t.d[r];if(!n)for(var i in this.domainRegexes)if(e.match(this.domainRegexes[i].regex)){r=String(p(this.domainRegexes[i].domain)),n=t.d[r];break}return{rule:n,hash:r}},e.prototype.getChannelRule=function(e){var t;return this.policy.d&&(t=this.policy.d[e]),{rule:t}},e}(),Ve=function(e){var t,r,n,i,o,s,a=/(?:((\D)|^))(?<dateCapture>[0-9]{13}|[0-9]{10})(?:((\D)|$))/.exec(e),c=e.split("").map((function(e){return parseInt(e,10)?Math.floor(10*Math.random()):e})).join(""),u=c;if(a&&a.length>0&&a.groups){var l=a.groups.dateCapture,h=l;10===l.length&&(h=l+"000");var p=new Date(parseInt(h,10));if((t=p,r=new Date,n=t.getFullYear(),i=r.getFullYear(),o=t.getMonth(),s=r.getMonth(),Math.abs(s+12*i-(o+12*n)))<=1){var d=e.indexOf(l),f=l.length+d;u=c.substring(0,d)+l+c.substring(f)}}return u};function _e(e,t){if(null==t)return e?"CMPA":"A";if(t.match(Ie))return 0;for(var r="",n=0;n<t.length;n++)r+="A";return e?"CMP"+r:r}function De(e){if(void 0!==e){for(var t=0;t<e.length;t++)'"'!=e.charAt(t)||0!=t&&"\\"==e.charAt(t-1)||(e=e.substr(0,t)+"\\"+e.substr(t),t++);return e}}function Ke(e){for(var t=" ".charCodeAt(0),r="~".charCodeAt(0),n=0;n<e.length;n++){var i=e.charCodeAt(n);if(i<t||i<256&&i>r)return!0}return!1}function Fe(e,t){if(null!=t)return Ne.MULTI;if("boolean"==typeof e||"number"==typeof e||null==e)return Ne.VALUE;if(!e||!e.length||Ke(e))return Ne.VALUE;var r=function(e){try{var t=JSON.parse(e);return"object"==typeof t&&(Array.isArray(t)?Ne.JSON_A:Ne.JSON)}catch(e){return!1}}(e);if(r)return r;if(function(e){try{return!Ke(atob(e))}catch(e){return!1}}(e))return Le.B64;var n,i,o=function(e){if(e.includes("="))return!1;try{return decodeURIComponent(e)!=e&&Le.URL_ENC}catch(e){return!1}}(e);return o||((n=e).startsWith(";")&&n.includes("=")?Ne.URL_SEMICOLON:-1!=(i=e).indexOf("=")&&-1!=i.indexOf("?")&&i.indexOf("?")<i.indexOf("=")?Ne.ENDPOINT:function(e){if(e.startsWith("="))return!1;if(!e.includes("="))return!1;var t=e.split("=").length-1;return!(t>1&&!e.includes("&"))&&(1!=t||e.indexOf("=")<20)}(e)?Ne.URL_QUERY:Ne.VALUE)}!function(e){e[e.JSON=11]="JSON",e[e.JSON_A=12]="JSON_A",e[e.MULTI=13]="MULTI",e[e.VALUE=14]="VALUE",e[e.URL_QUERY=15]="URL_QUERY",e[e.URL_SEMICOLON=16]="URL_SEMICOLON",e[e.ENDPOINT=17]="ENDPOINT"}(Ne||(Ne={})),function(e){e[e.B64=1]="B64",e[e.URL_ENC=2]="URL_ENC",e[e.NONE=3]="NONE"}(Le||(Le={}));var Be=function(e,t){this.k=e,this.v=t},qe="AapjeNYYK",We=function(){function e(t,r,n,i,o,s){var a=this;if(this.parent=t,this.policyKey=r,this.orig=n,this.boundary=i,this.isString=o,this.isFirstCall=s,this.enc=Le.NONE,null==n||"object"!=typeof n)this.type=Fe(n,i),this.orig=n+="",this.params=this.parse(n),this.params.forEach((function(e){if(e.v.type==Ne.VALUE){var t=e.v.policyKey,r=e.v.orig;e.v.result=a.filterParam(t,r),a.parent.eventLogger(t,r,e.v.result),e.v.result.resultType!=h.NoIntervention&&(e.v.orig=e.v.result.resValue)}})),this.orig=this.orig.replace(/\n/g,qe);else{for(var c in this.params=new Array,this.type=Array.isArray(n)?Ne.JSON_A:Ne.JSON,n){var u=n[c],l=Array.isArray(n)?"["+c+"]":c,p=this.policyKey?this.policyKey+(Array.isArray(n)?"":".")+l:l,d=new Be(c,new e(this.parent,p,u,void 0,"string"==typeof u,!1));if(d.v.type==Ne.VALUE){var f=d.v.policyKey,y=d.v.orig;d.v.result=this.filterParam(f,y),this.parent.eventLogger(f,y,d.v.result)}this.params.push(d)}this.params.length||(this.type=Ne.VALUE,this.orig="")}}return e.prototype.parse=function(t){var r=this,n=[];switch(this.type){case Ne.JSON:try{var i=JSON.parse(t);for(var o in i){var a=this.policyKey?this.policyKey+"."+o:o,c=i[o];n.push(new Be(o,new e(this.parent,a,c,void 0,"string"==typeof c,!1)))}}catch(e){s("qp-err 1",e)}break;case Ne.JSON_A:try{(i=JSON.parse(t)).forEach((function(t,i){n.push(new Be(r.policyKey,new e(r.parent,r.policyKey?r.policyKey+"["+i+"]":"["+i+"]",t,void 0,"string"==typeof t,!1)))}))}catch(e){s("qp-err 2",e)}break;case Ne.MULTI:var u=function(e,t){var r=Array(),n=e.split(t);for(var i in n)if(i.includes("Content-Disposition:")){var o=i.split("Content-Disposition:");for(var s in o)if(s.includes("name=")){var a=s.indexOf("name=")+"name=".length,c=(s=s.substring(a,s.length-1)).indexOf("\r\n"),u=s.substring(0,c);u=(u=u.trim().replace("\\\\s","")).trim().replace('"',"");var l=s.substring(c+1);l=l.trim().replace("\\\\s",""),r.push([u,l])}}return r}(t,this.boundary);for(var l in u){var h=l[0],p=l[1];n.push(new Be(h,new e(this.parent,h,p,void 0,!1,!1)))}break;case Ne.URL_QUERY:t.split("&").forEach((function(t){if(t){var i=t.indexOf("="),o=t.substring(0,i),s=t.substring(i+1),a=r.policyKey?r.policyKey+"."+o:o;n.push(new Be(o,new e(r.parent,a,s,void 0,!1,!1)))}}));break;case Ne.ENDPOINT:var d=t.indexOf("?"),f=t.substring(0,d),y=t.substring(d+1),g=this.policyKey?this.policyKey+".qpBase":"qpBase",v=this.policyKey?this.policyKey:"qpBase";n.push(new Be("qpBase",new e(this.parent,g,f,void 0,!1,!1))),n.push(new Be("qpBase",new e(this.parent,v,y,void 0,!1,!1)));break;case Ne.URL_SEMICOLON:t.substring(1).split(";").forEach((function(t){var i=t.indexOf("="),o=t.substring(0,i),s=t.substring(i+1),a=r.policyKey?r.policyKey+"."+o:o;n.push(new Be(o,new e(r.parent,a,s,void 0,!1,!1)))}));break;case Le.URL_ENC:this.orig=decodeURIComponent(t),this.enc=Le.URL_ENC,this.type=Fe(this.orig),n=this.parse(this.orig);break;case Le.B64:this.orig=atob(t),this.enc=Le.B64,this.type=Fe(this.orig),n=this.parse(this.orig);break;case Ne.VALUE:this.isFirstCall&&(this.result=this.filterParam(this.policyKey,this.orig),this.parent.eventLogger(this.policyKey,this.orig,this.result))}return n},e.prototype.getResult=function(){var e;return t(this,void 0,Promise,(function(){var t,n,i,o,s,a,c,l,p;return r(this,(function(r){switch(r.label){case 0:if(this.params.forEach((function(e){"string"==typeof e.v.orig&&(e.v.orig=e.v.orig.replace(/\n/g,qe))})),this.type!=Ne.VALUE)return[3,2];switch(this.enc){case Le.B64:this.orig=btoa(this.orig);break;case Le.URL_ENC:this.orig=encodeURIComponent(this.orig)}return f.mode!=u.Enforce||this.result.resultType==h.NoIntervention?[2,{res:h.NoIntervention,val:this.orig}]:this.result.resultType==h.BlockEntirely?[2,{res:this.result.resultType,val:_e(this.result.isBlockedByCMP,null===(e=this.result)||void 0===e?void 0:e.origValue.value)+""}]:(t={res:this.result.resultType},[4,this.result.resValue]);case 1:return[2,(t.val=r.sent(),t)];case 2:switch(n="",this.type){case Ne.JSON:n+="{";break;case Ne.JSON_A:n+="[";break;case Ne.URL_SEMICOLON:n+=";"}i=0,o=0,s=this.params,r.label=3;case 3:return o<s.length?(a=s[o],c=a.k,[4,(l=a.v).getResult()]):[3,6];case 4:switch(p=r.sent(),i?i!=p.res&&(i=h.ModifyRequest):i=p.res,this.type){case Ne.JSON_A:n+=l.isString||l.result&&l.result.origValue?'"'+De(p.val)+'"':p.val,n+=",";break;case Ne.JSON:n+='"'+De(c)+'":',n+=l.isString||l.result&&l.result.origValue?'"'+De(p.val)+'"':p.val,n+=",";break;case Ne.MULTI:n+="!!!!!!"+c+"@@@@@@"+p.val;break;case Ne.URL_QUERY:n+=c+"="+p.val+"&";break;case Ne.URL_SEMICOLON:n+=c+"="+p.val+";";break;case Ne.ENDPOINT:n+=p.val+"?"}r.label=5;case 5:return o++,[3,3];case 6:switch(this.type){case Ne.JSON_A:","==n.charAt(n.length-1)&&(n=n.substr(0,n.length-1)),n+="]";break;case Ne.JSON:","==n.charAt(n.length-1)&&(n=n.substr(0,n.length-1)),n+="}";break;case Ne.URL_QUERY:n.length>0&&"&"==n.charAt(n.length-1)&&(n=n.substr(0,n.length-1));break;case Ne.ENDPOINT:n.length>0&&n.charAt(n.length-1);break;case Ne.URL_SEMICOLON:n.length>0&&";"==n.charAt(n.length-1)&&(n=n.substr(0,n.length-1))}switch(this.enc){case Le.B64:n=btoa(n);break;case Le.URL_ENC:n=encodeURIComponent(n)}return i||(i=h.NoIntervention),[2,{val:n,res:i}]}}))}))},e.prototype.liteFilterParam=function(e,t,r){var n=this.parent.policy.lt.blackCookie,i=this.parent.policy.lt.grayCookie;if("cookie"==this.parent.host){if(n)for(var o=0;o<n.length;o++)if(n[o].toUpperCase()==e.toUpperCase())return r.origValue.paramIndex=i?o+i.length:o,r.code=l.blocked,r;if(i){for(var s=!1,a=0;a<i.length;a++)if(i[a].toUpperCase()==e.toUpperCase()&&(s=!0,r.origValue.paramIndex=a,this.parent.policy.cm&&Oe(a,this.parent.policy.cm.cookieGroup,this.parent.policy.cm.policy)))return r.code=l.blocked,r.isBlockedByCMP=!0,r;if(!s)return r.code=l.unknownParam,r}}var c=this.parent.policy.liteRegexViolation(t);return null!=c?(r.origValue.regexIndex=c,r.code=l.dataViolation,r):(r.resultType=h.NoIntervention,r)},e.prototype.filterParam=function(e,t){e||(e="null");var r=JSON.parse(JSON.stringify(this.parent.result));if(r.resultType=h.BlockEntirely,r.origValue={param:e,value:t},r.isBlockedByCMP=!1,this.parent.policy.mode==u.Mapping||r.code==l.unknownDomain||r.code==l.unknownEndpoint||r.code==l.blocked){if(r.code==l.unknownDomain||r.code==l.unknownEndpoint){var n=this.parent.policy.checkDataViolation2(t,this.parent.policy.regexForUnknown);n&&(r.origValue.regexIndex=n.regexIndex)}if(this.parent.channel==c.EXTENSIONS){var i=this.parent.policy.checkDataViolation2(t,[1,2,3,4,5,6,7,8,9,10]);i?r.origValue.regexIndex=i.regexIndex:r.resultType=h.NoIntervention}return r}if(this.parent.policy.lt)return this.liteFilterParam(e,t,r);var o=this.parent.policy.getParamRule2(e,this.parent.endPointRule);if(!o){var s=this.parent.policy.checkIfAllowAllParams(this.parent.endPointRule);if(s){r.origValue.paramIndex=s.i;var a=this.parent.policy.checkDataViolation2(t,this.parent.endPointRule.r);return a?(r.origValue.regexIndex=a.regexIndex,r.code=l.dataViolation,r):(r.code=l.allowed,r.resultType=h.NoIntervention,r)}var p=this.parent.policy.checkDataViolation2(t,this.parent.policy.regexForUnknown);return p&&(r.origValue.regexIndex=p.regexIndex),p||this.parent.channel!=c.EXTENSIONS||(r.resultType=h.NoIntervention),r.code=l.unknownParam,r}if(r.origValue.paramIndex=o.i,1==o.b)return r.code=l.blocked,r;var d=this.parent.policy.checkStructureViolation2(t,o.r);if(d)return r.origValue.regexIndex=d.regexIndex,r.code=l.structureViolation,r;if(2==o.b)return r.resValue=Ve(t),r.code=l.anon,r.resultType=h.ModifyRequest,r;if(3==o.b)return r.resValue=re.encryptValue(t),r.code=l.psuado,r.resultType=h.ModifyRequest,r;var f=this.parent.policy.checkDataViolation2(t,this.parent.endPointRule.r);return!f||o.trustedForRegex&&-1!=o.trustedForRegex.indexOf(f.regexIndex+"")?(r.resultType=h.NoIntervention,r):(r.origValue.regexIndex=f.regexIndex,r.code=l.dataViolation,r)},e}(),Je=function(){function e(e,t,r,n,i){if(this.policy=e,this.channel=t,this.host=r,this.endPoint=n,this.eventLogger=i,this.result={resultType:h.NoIntervention,code:l.allowed},this.result.channel=t,e.mode!=u.KillSwitch&&e.mode!=u.Mapping){if(e.lt){if("cookie"==r)this.result.domainIndex=0;else for(var o in e.lt.grayList)r.includes(e.lt.grayList[o])&&(this.result.domainIndex=parseInt(o)+1);return this.result.endpointIndex=0,this.result.code=l.allowed,void(this.result.resultType=h.NoIntervention)}var s;e.mode!=u.SoftLaunch&&(this.result.resultType=h.BlockEntirely);var a=!0;if(t==c.EXTENSIONS?(s=e.getChannelRule(c.HTTP).rule)||(a=!1,s=e.getChannelRule(t).rule):s=e.getChannelRule(t).rule,!s)return this.result.code=l.unknownDomain,void(t==c.EXTENSIONS&&(this.result.resultType=h.NoIntervention));if(1!=s.b){var p=e.getDomainRule2(r,s).rule;if(t==c.EXTENSIONS&&a&&!p){if(a=!1,!(s=e.getChannelRule(t).rule))return this.result.code=l.unknownDomain,void(t==c.EXTENSIONS&&(this.result.resultType=h.NoIntervention));p=e.getDomainRule2(r,s).rule}if(!p)return this.result.code=l.unknownDomain,void(t==c.EXTENSIONS&&(this.result.resultType=h.NoIntervention));if(t==c.EXTENSIONS&&a&&(t=c.HTTP),this.result.domainIndex=p.i,1!=p.b){var d=e.getEndpointRule2(n,p),f=d.usedFinder,y=d.rule;if(!y)return this.result.code=l.unknownEndpoint,void(t==c.EXTENSIONS&&(this.result.resultType=h.NoIntervention));this.endPointRule=y,this.result.endpointIndex=y.i,this.result.endpointFinderUsed=f,1!=y.b?this.result.resultType=h.ModifyRequest:this.result.code=l.blocked}else this.result.code=l.blocked}else this.result.code=l.blocked}}return e.prototype.parse=function(e,n,i){return t(this,void 0,Promise,(function(){return r(this,(function(t){switch(t.label){case 0:return[4,new We(this,e,n,i,!1,!0).getResult()];case 1:return[2,t.sent()]}}))}))},e}();(new(function(){function t(){var e,t,r,n=this;this.messageHandlers=new Map([[ce.register,this.register.bind(this)],[ce.control,this.control.bind(this)],[ce.updateSegment,this.updateSegment.bind(this)],[ce.defineFunction,this.defineFunction.bind(this)],[ce.addTrustedDomains,this.addTrustedDomains.bind(this)],[ce.setIgnoreList,this.setIgnoreList.bind(this)],[ce.process2,this.process2.bind(this)],[ce.liteBlockLog,this.liteLog.bind(this)],[ce.setUQ,this.setUQ.bind(this)],[ce.setPassword,this.setPassword.bind(this)],[ce.setMaskType,this.updateReportMask.bind(this)],[ce.setEncryptType,this.updateReportEncrypt.bind(this)],[ce.setEncryptTypeAndUQ,this.updateReportEncryptAndUQ.bind(this)],[ce.setThirdPartyEncrypt,this.updateThirdPartyEncrypt.bind(this)]]),this.browser=(t=navigator.userAgent,r=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[],/trident/i.test(r[1])?{name:"IE",version:(e=/\brv[ :]+(\d+)/g.exec(t)||[])[1]||""}:"Chrome"===r[1]&&null!=(e=t.match(/\bOPR|Edge\/(\d+)/))?{name:"Opera",version:e[1]}:(r=r[2]?[r[1],r[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(e=t.match(/version\/(\d+)/i))&&r.splice(1,1,e[1]),{name:r[0],version:r[1]})),this.reqs=new Map,this.cachedMsgs=new Array,setInterval((function(){n.cachedMsgs.forEach((function(e,t){Date.now()-e.time>3e5&&n.cachedMsgs.splice(t,1)}))}),3e5)}return t.prototype.listen=function(){self.onmessage=this.onMessage.bind(this)},t.prototype.onMessage=function(e){var t=e.data.qp_action;if(t){var r=this.messageHandlers.get(t);if(!r)return s("WebWorkerApp:onMessage","Received unknown action.");r(e.data)}},t.prototype.liteLog=function(e){var t=e,r=t.eom,n=t.eu,i=t.ppr;this.reporter.report2(r,n,[i])},t.prototype.register=function(e){var t=this;console.log("worker loaded "+i);var r=e,n=r.policy,s=r.referrer,a=r.segment,c=r.server,u=r.disablePolicyFetch,l=r.reportIP,h=r.liteSDK,p=r.consentMangment,d=r.domainRegex,y=r.regexForUnknown,g=r.trustedParamExpression,v=r.regexWords,m=s.indexOf("?"),b=s;-1!=m&&(b=b.substring(0,m)),this.segment=a,this.sdkloc=b,this.server=c,this.policy=new Me(n,h,p,d,y,g),f.mode=this.policy.mode,this.fetcher=new f(n,u,c+"/connect/static/",a,(function(e){var r;t.policy=new Me(e,h,p,d,y,g,v),null===(r=t.reporter)||void 0===r||r.updateReportServer(t.policy.eventServerUrl),t.post({qp_id:199,data:t.policy.mode})})),this.reporter=new he(this.policy.eventServerUrl,this.ignoreLogs,l),o("WebWorkerApp:register","Webworker registered policyObj")},t.prototype.post=function(e){self.postMessage(e)},t.prototype.process2=function(t){var r=this,n=t.action,o=t.id;if(!this.policy)return this.post({qp_id:o,error:"missing policy"});var s,a,c=this.reqs.get(o);switch(n){case pe.start:if(c)return this.post({qp_id:o,type:ue.init,error:"already called start for this id "+o});var l=t,f=this.policy.isTrustedDomain(l.host,this.additionalTrustedDomains);if(f)return this.post({qp_id:o,type:ue.init,data:{trusted:f,block:!1}});var y=e(e({},l),{reports:new Array,paramParser:new Je(this.policy,l.channel,l.host,l.endPoint,(function(e,t,r){y.reports.push(r)})),trusted:f,meta:{v:this.policy.version,s:p(this.segment),l:this.sdkloc,m:this.policy.mode,p:ne.Web,uq:d+(this.uq?"::"+this.uq:"")+"::"+this.browser.name+"-"+this.browser.version+"::"+i}});y.reports.push(y.paramParser.result),this.reqs.set(o,y),this.post({qp_id:o,type:ue.init,data:{trusted:y.trusted,block:y.paramParser.result.resultType==h.BlockEntirely}});break;case pe.end:if(!c)throw"missing for this id "+o;var g=new oe(c.source,{host:c.host,endpoint:c.endPoint});if(c.source==z.websocket||c.source==z.postMessage){var v=(s=c.reports,a="",s.forEach((function(e){if(e.origValue){var t=e.origValue.param;if(t){var r=t.match("[[0-9]*]");r&&(t=t.replace(r[0],"[*]")),a.includes(t)||(a+=t)}}})),a);v?this.shouldSkipReport(v)||(this.cachedMsgs.push({keys:v,time:Date.now()}),this.reporter.report2(c.meta,g,c.reports,c.caller)):this.reporter.report2(c.meta,g,c.reports,c.caller)}else this.reporter.report2(c.meta,g,c.reports,c.caller);this.reqs.delete(o);break;case pe.param:var m=t;if(!c)return this.post({qp_id:o,data:{index:m.index},type:ue.param,error:"must call start before sendParam / or maybe already called end"});if(c.trusted)return this.post({qp_id:o,data:{index:m.index},type:ue.param});if(!m.val)return this.post({qp_id:o,data:{index:m.index},type:ue.param,error:"missing value not parsing "+m.val});c.paramParser.parse(m.key,m.val,m.boundery).then((function(t){r.policy.mode==u.SoftLaunch&&(t.res=h.NoIntervention),r.post({qp_id:o,data:e({index:m.index},t),type:ue.param})}))}},t.prototype.shouldSkipReport=function(e){for(var t=0;t<this.cachedMsgs.length;t++){if(this.cachedMsgs[t].keys==e)return o("skipping report",this.cachedMsgs),!0}return!1},t.prototype.control=function(e){var t=e.eventsReporter;switch(o("WebWorkerApp:control","Webworker received control rawMessage",t),t){case fe.flush:this.reporter.sendEvents();break;case fe.start:this.reporter.start()}},t.prototype.defineFunction=function(e){var t=e,r=t.functionName,n=t.serializedFunction;o("WebWorkerApp:defineFunction","Webworker received serialized function",n);try{r===de.mask?te.setCustomMaskLegacy(new Function("return "+n)()):r===de.encrypt&&te.setCustomEncryptLegacy(new Function("return "+n)())}catch(e){s("WebWorkerApp:defineFunction","Failed to construct function",e)}},t.prototype.addTrustedDomains=function(e){o("WebWorkerApp:addTrustedDomains","WebWorker received trusted domains",e.trusted),this.additionalTrustedDomains=e.trusted},t.prototype.setIgnoreList=function(e){o("WebWorkerApp:ignoreEvent","WebWorker received ignored events",e.ignored),this.ignoreLogs=e.ignored},t.prototype.setUQ=function(e){this.uq=e.uq},t.prototype.setPassword=function(e){this.password=e.pass,te.setEncKey(e.pass)},t.prototype.updateSegment=function(e){var t,r,n;this.segment=e.segment,null===(t=this.fetcher)||void 0===t||t.updatePolicyUrl(this.server+"/connect/static/"+this.segment+".json"),this.policy&&(null===(r=this.reporter)||void 0===r||r.updateReportServer(this.policy.eventServerUrl)),null===(n=this.reporter)||void 0===n||n.sendEvents()},t.prototype.updateReportMask=function(e){te.setMaskAlgoType(e.type)},t.prototype.updateThirdPartyEncrypt=function(e){e.type&&re.setEncAlgoType(e.type),e.encKey&&re.setEncKey(e.encKey)},t.prototype.updateReportEncrypt=function(e){te.setEncKey(e.encKey),te.setEncAlgoType(e.type)},t.prototype.updateReportEncryptAndUQ=function(e){var t=this;te.setEncKey(e.encKey),te.setEncAlgoType(e.type),"asymmetric.v2"==e.type?te.createAssymetricV2Key().then((function(r){t.uq=e.baseUQ+"::"+r})).catch((function(e){return console.error("Can't create asym key!",e)})):this.uq=e.baseUQ},t}())).listen()}));
