var myApp,Keepalive;!function(n,t,i){"use strict";t.module("ngIdle",["ngIdle.keepalive","ngIdle.idle","ngIdle.countdown","ngIdle.title","ngIdle.localStorage"]);t.module("ngIdle.keepalive",[]).provider("Keepalive",function(){var n={http:null,interval:600},i;this.http=function(i){if(!i)throw new Error("Argument must be a string containing a URL, or an object containing the HTTP request configuration.");t.isString(i)&&(i={url:i,method:"GET"});i.cache=!1;n.http=i};i=this.interval=function(t){if(t=parseInt(t),isNaN(t)||0>=t)throw new Error("Interval must be expressed in seconds and be greater than 0.");n.interval=t};this.$get=["$rootScope","$log","$interval","$http",function(r,u,f,e){function s(n,t){r.$broadcast("KeepaliveResponse",n,t)}function h(){r.$broadcast("Keepalive");t.isObject(n.http)&&e(n.http).success(s).error(s)}var o={ping:null};return{_options:function(){return n},setInterval:i,start:function(){return f.cancel(o.ping),o.ping=f(h,1e3*n.interval),o.ping},stop:function(){f.cancel(o.ping)},ping:function(){h()}}}]});t.module("ngIdle.idle",["ngIdle.keepalive","ngIdle.localStorage"]).provider("Idle",function(){var n={idle:1200,timeout:30,autoResume:"idle",interrupt:"mousemove keydown DOMMouseScroll mousewheel mousedown touchstart touchmove scroll",keepalive:!0},r=this.timeout=function(i){if(i===!1)n.timeout=0;else{if(!(t.isNumber(i)&&i>=0))throw new Error("Timeout must be zero or false to disable the feature, or a positive integer (in seconds) to enable it.");n.timeout=i}},i;this.interrupt=function(t){n.interrupt=t};i=this.idle=function(t){if(0>=t)throw new Error("Idle must be a value in seconds, greater than 0.");n.idle=t};this.autoResume=function(t){n.autoResume=t===!0?"idle":t===!1?"off":t};this.keepalive=function(t){n.keepalive=t===!0};this.$get=["$interval","$log","$rootScope","$document","Keepalive","IdleLocalStorage","$window",function(u,f,e,o,s,h,c){function p(){n.keepalive&&(l.running&&s.ping(),s.start())}function a(){n.keepalive&&s.stop()}function w(){l.idling=!l.idling;var t=l.idling?"Start":"End";e.$broadcast("Idle"+t);l.idling?(a(),n.timeout&&(l.countdown=n.timeout,b(),l.timeout=u(b,1e3,n.timeout,!1))):p();u.cancel(l.idle)}function b(){return l.countdown<=0?void k():(e.$broadcast("IdleWarn",l.countdown),void l.countdown--)}function k(){a();u.cancel(l.idle);u.cancel(l.timeout);l.idling=!0;l.running=!1;l.countdown=0;e.$broadcast("IdleTimeout")}function d(n,t,i){var r=n.running();n.unwatch();t(i);r&&n.watch()}function tt(){var n=h.get("expiry");return n&&n.time?new Date(n.time):null}function g(n){n?h.set("expiry",{id:nt,time:n}):h.remove("expiry")}var l={idle:null,timeout:null,idling:!1,running:!1,countdown:null},nt=(new Date).getTime(),v={_options:function(){return n},_getNow:function(){return new Date},getIdle:function(){return n.idle},getTimeout:function(){return n.timeout},setIdle:function(n){d(this,i,n)},setTimeout:function(n){d(this,r,n)},isExpired:function(){var n=tt();return null!==n&&n<=this._getNow()},running:function(){return l.running},idling:function(){return l.idling},watch:function(t){u.cancel(l.idle);u.cancel(l.timeout);var i=n.timeout?n.timeout:0;t||g(new Date((new Date).getTime()+1e3*(n.idle+i)));l.idling?w():l.running||p();l.running=!0;l.idle=u(w,1e3*n.idle,0,!1)},unwatch:function(){u.cancel(l.idle);u.cancel(l.timeout);l.idling=!1;l.running=!1;g(null);a()},interrupt:function(t){if(l.running)return n.timeout&&this.isExpired()?void k():void(("idle"===n.autoResume||"notIdle"===n.autoResume&&!l.idling)&&this.watch(t))}},y;o.find("html").on(n.interrupt,function(n){"mousemove"===n.type&&n.originalEvent&&0===n.originalEvent.movementX&&0===n.originalEvent.movementY||("mousemove"!==n.type||t.isUndefined(n.movementX)||n.movementX||n.movementY)&&v.interrupt()});return y=function(n){if("ngIdle.expiry"===n.key&&n.newValue&&n.newValue!==n.oldValue){var i=t.fromJson(n.newValue);if(i.id===nt)return;v.interrupt(!0)}},c.addEventListener?c.addEventListener("storage",y,!1):c.attachEvent("onstorage",y),v}]});t.module("ngIdle.countdown",["ngIdle.idle"]).directive("idleCountdown",["Idle",function(n){return{restrict:"A",scope:{value:"=idleCountdown"},link:function(t){t.value=n.getTimeout();t.$on("IdleWarn",function(n,i){t.$evalAsync(function(){t.value=i})});t.$on("IdleTimeout",function(){t.$evalAsync(function(){t.value=0})})}}}]);t.module("ngIdle.title",[]).provider("Title",function(){function i(n,t,i){return new Array(t-String(n).length+1).join(i||"0")+n}var n={enabled:!0},r=this.enabled=function(t){n.enabled=t===!0};this.$get=["$document","$interpolate",function(u,f){var e={original:null,idle:"{{minutes}}:{{seconds}} until your session times out!",timedout:"Your session has expired."};return{setEnabled:r,isEnabled:function(){return n.enabled},original:function(n){return t.isUndefined(n)?e.original:void(e.original=n)},store:function(n){(n||!e.original)&&(e.original=this.value())},value:function(n){return t.isUndefined(n)?u[0].title:void(u[0].title=n)},idleMessage:function(n){return t.isUndefined(n)?e.idle:void(e.idle=n)},timedOutMessage:function(n){return t.isUndefined(n)?e.timedout:void(e.timedout=n)},setAsIdle:function(n){this.store();var t={totalSeconds:n};t.minutes=Math.floor(n/60);t.seconds=i(n-60*t.minutes,2);this.value(f(this.idleMessage())(t))},setAsTimedOut:function(){this.store();this.value(this.timedOutMessage())},restore:function(){this.original()&&this.value(this.original())}}}]}).directive("title",["Title",function(n){return{restrict:"E",link:function(t,i,r){n.isEnabled()&&!r.idleDisabled&&(n.store(!0),t.$on("IdleStart",function(){n.original(i[0].innerText)}),t.$on("IdleWarn",function(t,i){n.setAsIdle(i)}),t.$on("IdleEnd",function(){n.restore()}),t.$on("IdleTimeout",function(){n.setAsTimedOut()}))}}}]);t.module("ngIdle.localStorage",[]).service("IdleStorageAccessor",["$window",function(n){return{get:function(){return n.localStorage}}}]).service("IdleLocalStorage",["IdleStorageAccessor",function(n){function u(){var n={};this.setItem=function(t,i){n[t]=i};this.getItem=function(t){return"undefined"!=typeof n[t]?n[t]:null};this.removeItem=function(t){n[t]=i}}function f(){try{var t=n.get();return t.setItem("ngIdleStorage",""),t.removeItem("ngIdleStorage"),t}catch(i){return new u}}var r=f();return{set:function(n,i){r.setItem("ngIdle."+n,t.toJson(i))},get:function(n){return t.fromJson(r.getItem("ngIdle."+n))},remove:function(n){r.removeItem("ngIdle."+n)},_wrapped:function(){return r}}}])}(window,window.angular),function(){var n=angular.module("app.PersonalArea.Idle",["ngIdle"]).config(["$keepaliveProvider","$idleProvider",function(n,t){t.activeOn("mousemove keydown DOMMouseScroll mousewheel mousedown");t.idleDuration(5);t.warningDuration(30);t.keepalive(!0);t.autoResume(!0);n.interval(10)}]).run(["$keepalive","$idle",function(n,t){t.watch();(t.running()||t.idling())&&t.unwatch();n.start();n.ping();n.stop()}]);angular.element(document.getElementById("idleApp")).ready(function(){angular.bootstrap(document.getElementById("idleApp"),["app.PersonalArea.Idle"])})}();myApp=angular.module("app.PersonalArea.Idle",["ngIdle"]);angular.module("app.PersonalArea.Idle",["ngIdle","ui.bootstrap"]).controller("app.PersonalArea.Idle.Controllers.IdleController",["$scope","Idle","Keepalive","$modal","$http",function(n,t,i,r,u){function f(){n.warning&&(n.warning.close(),n.warning=null);n.timedout&&(n.timedout.close(),n.timedout=null)}f();t.watch();n.started=!0;blinkTitle=function(){var i=document.title,t="...",n,r=function(){document.title=document.title==t?" ":t},u=function(){clearInterval(n);document.title=i;window.onmousemove=null;n=null};return function(){n||(n=setInterval(r,1e3),window.onmousemove=u)}}();n.$on("IdleStart",function(){function t(){n.warning=r.open({templateUrl:"warning-dialog.html",windowClass:"modal-danger"});blinkTitle()}f();console.log("IdleStart");u({url:"/services/ProxyRequestHandler.ashx?reqName=WizGetChatStatusReq",method:"POST"}).then(function(n){n&&n.data&&n.data.Success&&n.data.IsChatAlive||(localStorage.removeItem("IsWizChatActive"),t())},function(){t()})});n.$on("IdleEnd",function(){f()});n.$on("IdleTimeout",function(){var n=performExitLink||"/services/ProxyRequestHandler.ashx?reqName=performExitI";u.get(n).then(function(){window.location.reload(!0)});Logout()})}]).config(["IdleProvider","KeepaliveProvider",function(n,t){n.idle(600);n.timeout(30);t.interval(300);t.http("/services/ProxyRequestHandler.ashx?reqName=CardsList_102Digital&userGuid=NOSESSION_"+(new Date).getTime().toString());Keepalive()}]);Keepalive=function(){var n=location.origin.includes("isracard")?"i":"a";$.ajax({url:"/ProxyRingHandler/ProxyRingrequest",type:"POST",data:{serviceName:"keepalive",applicationId:n},dataType:"json",success:function(n){console.log("out",n)},error:function(n,t,i){console.log("error",n,t,i)}})}